"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.presets=exports.init=exports.removeElements=exports.removeElement=exports.removeDriver=exports.addElements=exports.addElement=exports.addDriver=exports.laxInstance=void 0;var isPresetName=function(e){return-1!==["fadeIn","fadeOut","fadeInOut","scaleIn","scaleOut","scaleInOut","slideX","slideY","jiggle","seesaw","zigzag","hueRotate","spin","flipX","flipY","blurIn","blurOut","blurInOut"].indexOf(e)},inOutMap=function(e){return["elInY+elHeight","elCenterY-"+(e=void 0===e?30:e),"elCenterY","elCenterY+"+e,"elOutY-elHeight"]},laxPresets={fadeInOut:function(e,t){return void 0===t&&(t=0),{opacity:[inOutMap(e=void 0===e?30:e),[t,1,1,1,t]]}},fadeIn:function(e,t){return{opacity:[["elInY+elHeight",e=void 0===e?"elCenterY":e],[t=void 0===t?0:t,1]]}},fadeOut:function(e,t){return{opacity:[[e=void 0===e?"elCenterY":e,"elOutY-elHeight"],[1,t=void 0===t?0:t]]}},blurInOut:function(e,t){return void 0===t&&(t=20),{blur:[inOutMap(e=void 0===e?100:e),[t,0,0,0,t]]}},blurIn:function(e,t){return{blur:[["elInY+elHeight",e=void 0===e?"elCenterY":e],[t=void 0===t?20:t,0]]}},blurOut:function(e,t){return{opacity:[[e=void 0===e?"elCenterY":e,"elOutY-elHeight"],[0,t=void 0===t?20:t]]}},scaleInOut:function(e,t){return void 0===t&&(t=.6),{scale:[inOutMap(e=void 0===e?100:e),[t,1,1,1,t]]}},scaleIn:function(e,t){return{scale:[["elInY+elHeight",e=void 0===e?"elCenterY":e],[t=void 0===t?.6:t,1]]}},scaleOut:function(e,t){return{scale:[[e=void 0===e?"elCenterY":e,"elOutY-elHeight"],[1,t=void 0===t?.6:t]]}},slideX:function(e,t){return{translateX:[["elInY",e=void 0===e?0:e],[0,t=void 0===t?500:t]]}},slideY:function(e,t){return{translateY:[["elInY",e=void 0===e?0:e],[0,t=void 0===t?500:t]]}},spin:function(e,t){return{rotate:[[0,e=void 0===e?1e3:e],[0,t=void 0===t?360:t],{modValue:e}]}},flipX:function(e,t){return{rotateX:[[0,e=void 0===e?1e3:e],[0,t=void 0===t?360:t],{modValue:e}]}},flipY:function(e,t){return{rotateY:[[0,e=void 0===e?1e3:e],[0,t=void 0===t?360:t],{modValue:e}]}},jiggle:function(e,t){return{skewX:[[0,+(e=void 0===e?50:e),2*e,3*e,4*e],[0,t=void 0===t?40:t,0,-t,0],{modValue:4*e}]}},seesaw:function(e,t){return{skewY:[[0,+(e=void 0===e?50:e),2*e,3*e,4*e],[0,t=void 0===t?40:t,0,-t,0],{modValue:4*e}]}},zigzag:function(e,t){return{translateX:[[0,+(e=void 0===e?100:e),2*e,3*e,4*e],[0,t=void 0===t?100:t,0,-t,0],{modValue:4*e}]}},hueRotate:function(e,t){return{"hue-rotate":[[0,e=void 0===e?600:e],[0,t=void 0===t?360:t],{modValue:e}]}}},transformKeys=["perspective","scaleX","scaleY","scale","skewX","skewY","skew","rotateX","rotateY","rotate"],filterKeys=["blur","hue-rotate","brightness"],translate3dKeys=["translateX","translateY","translateZ"],pxUnits=["perspective","border-radius","blur","translateX","translateY","translateZ"],degUnits=["hue-rotate","rotate","rotateX","rotateY","skew","skewX","skewY"];function getArrayValues(e,t){if(Array.isArray(e))return e;for(var n=Object.keys(e).map(function(e){return parseInt(e)}).sort(function(e,t){return t<e?1:-1}),r=n[n.length-1],i=0;i<n.length;i++){var a=n[i];if(t<a){r=a;break}}return e[r]}function lerp(e,t,n){return e*(1-n)+t*n}function invlerp(e,t,n){return(n-e)/(t-e)}function interpolate(e,t,n,r){var i=0;if(e.forEach(function(e){e<n&&i++}),i<=0)return t[0];if(i>=e.length)return t[e.length-1];var a=i-1,e=invlerp(e[a],e[i],n);return r&&(e=r(e)),lerp(t[a],t[i],e)}var easings={easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},easeOutBounce:function(e){var t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},easeInBounce:function(e){return 1-easings.easeOutBounce(1-e)},easeOutBack:function(e){return 1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2)},easeInBack:function(e){return 2.70158*e*e*e-1.70158*e*e}};function flattenStyles(r){var i={transform:"",filter:""},a={translateX:1e-5,translateY:1e-5,translateZ:1e-5};return Object.keys(r).forEach(function(e){var t=r[e],n=pxUnits.includes(e)?"px":degUnits.includes(e)?"deg":"";translate3dKeys.includes(e)?a[e]=t:transformKeys.includes(e)?i.transform+=e+"("+t+n+") ":filterKeys.includes(e)?i.filter+=e+"("+t+n+") ":i[e]=t+n+" "}),i.transform="translate3d("+a.translateX+"px, "+a.translateY+"px, "+a.translateZ+"px) "+i.transform,i}function getScrollPosition(){var e=void 0!==window.pageXOffset,t="CSS1Compat"===(document.compatMode||""),n=e?window.pageXOffset:(t?document.documentElement:document.body).scrollLeft;return[e?window.pageYOffset:(t?document.documentElement:document.body).scrollTop,n]}function parseValue(e,t,n){var r=t.width,i=t.height,a=t.x,o=t.y;if("number"==typeof e)return e;if("string"==typeof e){var s=document.body.scrollHeight,l=document.body.scrollWidth,u=window.innerWidth,d=window.innerHeight,c=getScrollPosition(),t=c[0],a=a+c[1],c=a+r,o=o+t,t=o+i;return Function("return "+e.replace(/screenWidth/g,String(u)).replace(/screenHeight/g,String(d)).replace(/pageHeight/g,String(s)).replace(/pageWidth/g,String(l)).replace(/elWidth/g,String(r)).replace(/elHeight/g,String(i)).replace(/elInY/g,String(o-d)).replace(/elOutY/g,String(t)).replace(/elCenterY/g,String(o+i/2-d/2)).replace(/elInX/g,String(a-u)).replace(/elOutX/g,String(c)).replace(/elCenterX/g,String(a+r/2-u/2)).replace(/index/g,String(n)))()}}var LaxDriver=function(e,t,n){var r=this;void 0===n&&(n={}),this.name="",this.lastValue=0,this.frameStep=1,this.m1=0,this.m2=0,this.inertia=0,this.inertiaEnabled=!1,this.getValue=function(e){var t=r.lastValue;return e%r.frameStep==0&&(t=r.getValueFn(e)),r.inertiaEnabled&&(e=t-r.lastValue,r.m1=.8*r.m1+e*(1-.8),r.m2=.8*r.m2+r.m1*(1-.8),r.inertia=Math.round(5e3*r.m2)/15e3),r.lastValue=t,[r.lastValue,r.inertia]},this.name=e,this.getValueFn=t,this.inertiaEnabled=n.inertiaEnabled,this.frameStep=n.frameStep,this.lastValue=this.getValueFn(0)},LaxElement=function(e,t,n,r,i,a){var E=this;void 0===i&&(i=0),void 0===a&&(a={}),this.styles={},this.selector="",this.groupIndex=0,this.update=function(e,t){var n,r=E.transforms,i={};for(n in r){var a=r[n];e[n]||console.error("No lax driver with name: ",n);var o,s,l,u,d,c,m,f,p,v,h=e[n],g=h[0],x=h[1],w=void 0;for(w in a)"presets"!==w&&(o=(d=a[w])[0],s=d[1],l=(m=void 0===(f=d[2])?{}:f).modValue,u=void 0===(c=m.frameStep)?1:c,v=m.easing,d=m.inertia,f=m.inertiaMode,c=m.cssFn,m=void 0===(m=m.cssUnit)?"":m,v=easings[v],t%u==0&&(v=interpolate(o,s,l?g%l:g,v),d&&(p=x*d,v+=p="absolute"===f?Math.abs(p):p),p="px"==(f=m||pxUnits.includes(w)?"px":degUnits.includes(w)?"deg":"")?0:3,v="px"==f?Number.parseFloat(v.toFixed(p)):v,i[w]=c?c(v,E.domElement):v+m))}E.applyStyles(i),E.onUpdate&&E.onUpdate(e,E.domElement)},this.calculateTransforms=function(){E.transforms={};var t,l=E.laxInstance.windowWidth;for(t in E.transformsData)!function(){var a=E.transformsData[t],o={},e=a.presets;(void 0===e?[]:e).forEach(function(e){var t,n=e.split(":"),r=n[0],i=n[1],e=n[2],n=window.lax.presets[r];n?(t=n(i,e),Object.keys(t).forEach(function(e){a[e]=t[e]})):console.error("Lax preset cannot be found with name: ",r)}),delete a.presets;var s=void 0;for(s in a)!function(){var e,t,n,r,i;"presets"!==s&&(r=void 0===(i=(e=a[s])[0])?[-1e9,1e9]:i,i=void 0===(t=e[1])?[-1e9,1e9]:t,e=void 0===(t=e[2])?{}:t,t=E.domElement.style.transform,E.domElement.style.removeProperty("transform"),n=E.domElement.getBoundingClientRect(),E.domElement.style.transform=t,r=getArrayValues(r,l).map(function(e){return parseValue(e,n,E.groupIndex)}),i=getArrayValues(i,l).map(function(e){return parseValue(e,n,E.groupIndex)}),o[s]=[r,i,e])}();E.transforms[t]=o}()},this.applyStyles=function(e){var t=flattenStyles(e);Object.keys(t).forEach(function(e){E.domElement.style.setProperty(e,t[e])})},this.selector=e,this.laxInstance=t,this.domElement=n,this.transformsData=r,this.groupIndex=i;var o=void 0===(i=a.style)?{}:i,a=a.onUpdate;Object.keys(o).forEach(function(e){n.style.setProperty(e,o[e])}),a&&(this.onUpdate=a),this.calculateTransforms()},Lax=function(){var a=this;this.drivers=[],this.elements=[],this.frame=0,this.debug=!1,this.windowWidth=0,this.windowHeight=0,this.presets=laxPresets,this.debugData={frameLengths:[],frameStart:0},this.init=function(){a.findAndAddElements(),window.requestAnimationFrame(a.onAnimationFrame),a.windowWidth=document.body.clientWidth,a.windowHeight=document.body.clientHeight,window.onresize=a.onWindowResize},this.onWindowResize=function(){document.body.clientWidth===a.windowWidth&&document.body.clientHeight===a.windowHeight||(a.windowWidth=document.body.clientWidth,a.windowHeight=document.body.clientHeight,a.elements.forEach(function(e){return e.calculateTransforms()}))},this.onAnimationFrame=function(e){a.debug&&(a.debugData.frameStart=Date.now());var t,n={};a.drivers.forEach(function(e){n[e.name]=e.getValue(a.frame)}),a.elements.forEach(function(e){e.update(n,a.frame)}),a.debug&&a.debugData.frameLengths.push(Date.now()-a.debugData.frameStart),a.frame%60==0&&a.debug&&(t=Math.ceil(a.debugData.frameLengths.reduce(function(e,t){return e+t},0)/60),console.log("Average frame calculation time: "+t+"ms"),a.debugData.frameLengths=[]),a.frame++,window.requestAnimationFrame(a.onAnimationFrame)},this.addDriver=function(e,t,n){void 0===n&&(n={}),a.drivers.push(new LaxDriver(e,t,n))},this.removeDriver=function(t){a.drivers=a.drivers.filter(function(e){return e.name!==t})},this.findAndAddElements=function(){a.elements=[],document.querySelectorAll(".lax").forEach(function(e){var t=[];e.classList.forEach(function(e){e.includes("lax_preset")&&(e=e.replace("lax_preset_",""),isPresetName(e)&&t.push(e))});var n=((n={}).scrollY={presets:t},n);a.elements.push(new LaxElement(".lax",a,e,n,0))})},this.addElements=function(n,r,i){document.querySelectorAll(n).forEach(function(e,t){a.elements.push(new LaxElement(n,a,e,r,t,i))})},this.removeElements=function(t){a.elements=a.elements.filter(function(e){return e.selector!==t})},this.addElement=function(e,t,n){a.elements.push(new LaxElement("",a,e,t,0,n))},this.removeElement=function(t){a.elements=a.elements.filter(function(e){return e.domElement!==t})}};exports.laxInstance=new Lax;var lax={addElements:exports.laxInstance.addElements,removeElements:exports.laxInstance.removeElements,removeElement:exports.laxInstance.removeElement,addElement:exports.laxInstance.addElement,init:exports.laxInstance.init,addDriver:exports.laxInstance.addDriver,removeDriver:exports.laxInstance.removeDriver,presets:exports.laxInstance.presets};"undefined"!=typeof module&&void 0!==module.exports?module.exports=lax:window?window.lax=lax:global&&(global.lax=lax),exports.default=lax,exports.addDriver=lax.addDriver,exports.addElement=lax.addElement,exports.addElements=lax.addElements,exports.removeDriver=lax.removeDriver,exports.removeElement=lax.removeElement,exports.removeElements=lax.removeElements,exports.init=lax.init,exports.presets=lax.presets;